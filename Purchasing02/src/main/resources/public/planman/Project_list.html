<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML><HEAD><TITLE>采购计划一览表</TITLE>
<SCRIPT language=JAVASCRIPT> 
function chck()
{  var  count=0;
   for (var i=0;i<form.length;i++)
   if ((form[i].type == "radio") && (form[i].checked))
   count++; 
   if (count==0)
      { return false;  }
   else
      { return true;   }
}
 
function Add(SourceList,TargetList)
	{
	var nIndex = SourceList.selectedIndex;
 	var nCount = 0;  
	if (nIndex == -1)
	{
		// Process continue only if at least one item selected
		//alert("请先选择一项!");
		return;
	}
	for (i=0;i<SourceList.length;i++)
  {
     if (SourceList.options(i).selected==true)
     {    
         if (inSouceList(SourceList.options(i).value,TargetList)==false)
         {
          	var objSelected = new Option(SourceList[i].text, SourceList[i].value);
           	TargetList.options[TargetList.length] = objSelected;
         }
     }     
	}
  for (var i=0;i<TargetList.options.length;i++)
  {
    TargetList.options(i).selected=true;
  }
	if(navigator.appName=="Netscape")
	{
		history.go(0)
	}
 }
 function inSouceList(SourceListOption,TargetList)
 {
 	  for (i=0;i<TargetList.length;i++)
    {
	     if (TargetList.options[i].value==SourceListOption)
       {
        	 return true;
       }
    }   
    return false;
 }  
function Remove(SelectList)
	{
	var nIndex = SelectList.selectedIndex;
 	var nCount = 0;
	if (nIndex == -1)
	{
		// Process continue only if at least one item selected
		//alert("请先选择一项!");
		return;
	}
  while(nCount<SelectList.length)
  {
       if (SelectList.options(nCount).selected==true)
       {
       	 SelectList.options[nCount] = null;
       }
       else
       {
         nCount++;
       }
  }
	if(navigator.appName=="Netscape")
		{
		history.go(0)
		}	
	}
 function enter()
 {
   var srcEle = window.event.srcElement;
   var tmp;   
   tmp = window.showModalDialog("pub_pub.Dialog_Date?vc_input=" + srcEle.value);
     if ( tmp.indexOf("/") != -1)
     {
        srcEle.value = tmp;
     }
     return;
 }   
 function check_num()
 {
 	 if (window.event.keyCode > 57 || window.event.keyCode < 48)
	 {
	 		window.event.returnValue = false;
	 }
 }
 function check_blank()
 {
 	 if (window.event.keyCode < 48)
	 {
	 		window.event.returnValue = false;
	 }
 }
  
function check_num_dot()
{
 	 if (window.event.keyCode > 57 || window.event.keyCode < 46)
	 {
  		 window.event.returnValue = false;   
	 }
   else
   {
      if(window.event.keyCode==47)
      {
    		 window.event.returnValue = false;
      }
      if(window.event.keyCode==46)
      {
         if (window.event.srcElement.value.indexOf(".")!=-1)
         {
        		 window.event.returnValue = false;
         }
      }   
    }  
 }
  
 function submitonce(theform)
 {
 if (document.all || document.getElementById)
 {
 for (i=0;i<theform.length;i++)
 {
 var tempobj = theform.elements[i]
 if (tempobj.type.toLowerCase() =="button")
 tempobj.disabled = true
 }
 }
 }
 
  function CheckAll() 
 {
   var i = 0;
   for (i=0; i < window.document.forms[0].elements.length; i++) 
   {
     if(window.document.forms[0].elements[i].Chk<3) 
     {
       if(window.document.forms[0].elements[i].value=="")
       {
         alert(window.document.forms[0].elements[i].alt);
         window.document.forms[0].elements[i].focus();
         return;
       }
       else if (window.document.forms[0].elements[i].Chk==2)
       {
         if (NotNumber(window.document.forms[0].elements[i].value))
         {
            alert("提示信息：\n不是有效的数字，请重新输入。");
            window.document.forms[0].elements[i].focus();
            return;
         }
       }
     }
     else if(window.document.forms[0].elements[i].Chk==3)
     {
       if(window.document.forms[0].elements[i].value!="")
       {
         if (NotNumber(window.document.forms[0].elements[i].value))
         {
            alert("提示信息：\n不是有效的数字，请重新输入。");
            window.document.forms[0].elements[i].focus();
            return;
         }
       }
     }
   }
   window.document.forms[0].submit();
   return true;
 }
 function NotNumber(Field)
 {
   var j = 0;
   var k = 0;
   for (var i=0; i<Field.length; i++)
   {
      var ch=Field.substring(i,i+1);
      if((ch>="0")&&(ch<="9")) 
      {
        j=0;
      }
      else if(ch==".") 
      {
        k++;
      }
      else
      {
        j=1;
        break;
      }
   }
   if ((j==0)&&(k<2))
   {
      return false;
   }
   else
   {
      return true;
   }
 }
 function openwindown(page)
 {
    window.open(page,"newuser","toolbar=no,location=no,directories=no,status=no,menubar=no,scrollbars=yes,resizable=yes,width=700,height=400,left=100,top=150");
 }
</SCRIPT>

<META http-equiv=Content-Language content=zh-cn>
<META http-equiv=Content-Type content="text/html; charset=utf-8">
<META content="MSHTML 6.00.2900.5626" name=GENERATOR>
<META content=FrontPage.Editor.Document name=ProgId><LINK 
href="../css/style.css" rel=stylesheet>
  <link rel="stylesheet" type="text/css"  href="../jquery-easyui-1.8.5\themes\default\easyui.css"/>
  <link rel="stylesheet" type="text/css" href="../jquery-easyui-1.8.5/themes/icon.css"/>
  <script type="text/javascript" src="../jquery-easyui-1.8.5/jquery.min.js"></script>
  <script type="text/javascript" src="../jquery-easyui-1.8.5/jquery.easyui.min.js"></script>
  <script type="text/javascript" src="../jquery-easyui-1.8.5\locale\easyui-lang-zh_CN.js"></script>

<SCRIPT language=javascript>
  $(function () {
     $("#dg").datagrid({
       url:"/findStockList",
       pagination:'true',
       rownumbers:'true',
       selectOnCheck:'true',
       singleSelect:'true',
       checkOnSelect:'true',
       pageList:[2,4,6,8,10],
       columns:[[
         {field:'',title:'',width:120,checkbox:true,align:'center'},
         {field:'stockName',title:'采购计划名称',width:250,align:'center'},
         {field:'stockType',title:'采购类型',width:270, align:'center'},
         {field:'stockStatus',title:'状态',width:250, align:'center',formatter:function (value,row,index) {
            if(value=="C001-30"){
                return "未确定";
            }else if(value=="C001-40"){
                return "待审批";
            }else if(value=="C001-50"){
                return "下达";
            }else if(value=="C001-51"){
                return "驳回";
            }else if(value=="C001-52"){
                return "废弃";
            }
           }},
         {field:'submitDate',title:'采购计划下达时间',width:250, align:'center'},
         {field:'enquireName',title:'对应询价书',width:270, align:'center'},
         {field:'sid',title:'采购id',hidden:true},
         {field:'oid',title:'需求id',hidden:true},
         {field:'imId',title:'编号对照id',hidden:true}

       ]]
     });

     //详情
     $("#btn1").click(function () {
       var rows= $("#dg").datagrid("getSelections");
       if(rows.length==0 || rows.length==null){
         alert("请选中一条数据！");
       }else if(rows.length>1){
         alert("一次只能选择一条数据！");
       }else{
         location.href="/findStockDetails?sid="+rows[0].sid+"&oid="+rows[0].oid+"&stockStatus="+rows[0].stockStatus;
       }
     });

     //报批
     $("#btn2").click(function () {
       var rows= $("#dg").datagrid("getSelections");
       if(rows.length==0 || rows.length==null){
         alert("请选中一条数据！");
       }else if(rows[0].stockStatus=="C001-40"){
         alert("请勿重复报批！");
       }else if(rows[0].stockStatus=="C001-51"){
         alert("驳回采购不允许报批！");
       }else if(rows[0].stockStatus=="C001-52"){
         alert("废弃采购不允许报批！");
       }else{
         if (confirm("点击确认以后将进入审核状态，状态变为待审核！")) {
             $.ajax({
                  url:"/StockApproval",
                  type:"get",
                  data:{"imId":rows[0].imId},
                   success:function (data) {
                      if(data=="true"){
                         alert("报批成功！");
                         //刷新页面
                         $("#dg").datagrid("reload");
                      }else{
                        alert("报批失败！");
                      }
           }
             });
         }
       }
     });

  });



    function select_check(theForm)
      {
        var count=0;
        for (var k = 0; k < theForm.length; k++)
        if ((theForm[k].type == "checkbox") && (theForm[k].checked))
        count++;
         if (count==0)
         {
            for (k = 0; k < theForm.length; k++)
            {
              if (theForm[k].type == "checkbox")
              theForm[k].checked=true;
            }
         }
         else
         {
            for (k = 0; k < theForm.length; k++)
            {
              if (theForm[k].type == "checkbox")
              theForm[k].checked=false;
            }
         }
      }
      
      function submit_Checkform(theForm,i)
      {
        var count=0;
        for (var k = 0; k < theForm.length; k++)
        if ((theForm[k].type == "checkbox") && (theForm[k].checked))
        count++;
        if (count==0)
        {
          alert("提示信息：\n请选择采购计划。");
          return;
        }
         document.form.p_type.value=i;
         window.document.form.submit();
         return true;
      }      
      function submit_form(theForm,i)
      {
        var count=0;
        for (var k = 0; k < theForm.length; k++)
        if ((theForm[k].type == "radio") && (theForm[k].checked))
        count++;
        if (count==0)
        {
          alert("提示信息：\n请选择采购计划。");
          return;
        }
        if (i==3)
        {
          form.action="../Enquire/Enquire_form.asp";
        }
        if (i==6)
        {
          form.action="../Bidding/bidding_add.asp";
        }
         window.document.form.submit();
         return true;
      }
      function submit_form_cx()
      {
        form.action="Project_list.asp";
        window.document.form.submit();
      }
	  function workLog() 
 	 {
  		window.open("work_log.htm","Canny1","toolbar=0,location=0,status=0,menubar=0,scrollbars=0,width=600,height=440,left=100,top=60");
      
 	 }
	  function xjfatzXjfamx() 
 	 {
  		window.open("xjfatz_xjfamx.htm","Canny1","toolbar=0,location=0,status=0,menubar=0,scrollbars=yes,width=600,height=440,left=100,top=60");
      
 	 }
</SCRIPT>
<style type="text/css">
<!--
.STYLE1 {color: #FF0000}
-->
</style>
</HEAD>
<BODY>
<DIV id=overDiv style="Z-INDEX: 1; POSITION: absolute"></DIV>
<CENTER>
<FORM name=form action="../../templates/xjfatz_xjfamx.html" method=post>
<H2><FONT color=#0070c0>采购计划一览表</FONT></H2>
<TABLE cellSpacing=1 cellPadding=0 width="100%" bgColor=#ffffff 
borderColorLight=#ffffff border=0>
  <TBODY>
  <TR>
    <TD>
      <TABLE cellSpacing=1 cellPadding=3 width="100%" border=0>
        <TBODY>
        <TR bgColor=#ffffff>
          <TD noWrap align=middle>采购计划名称：<INPUT size=10 
            name=p_title>&nbsp;&nbsp; 物资名称：<INPUT size=10 
            name=p_Item>&nbsp;&nbsp; 计划状态：<SELECT style="WIDTH: 115px" 
            name=p_status> <OPTION value="" selected>全部</OPTION> <OPTION 
              value=70>未确定</OPTION> <OPTION value=80>待审</OPTION> 
              <OPTION value=100>驳回</OPTION> <OPTION value=110>下达</OPTION> 
              <OPTION value=120>通过</OPTION> <OPTION value=140>废弃</OPTION> 
              </SELECT>&nbsp;&nbsp; 采购类型：<SELECT 
            style="WIDTH: 80px" name=p_stocktype> <OPTION value="" 
              selected>全部</OPTION> <OPTION value=1>公开求购</OPTION> <OPTION 
              value=2>定向询价</OPTION></SELECT>&nbsp;&nbsp; <INPUT onclick=submit_form_cx() type=button value=查询></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE>
  <FORM name="form1" action="../../templates/xjfatz_xjfamx.html" method="Post">

    <table id="dg"></table>
<INPUT type=hidden value=1 name=p_listtype>
<P align=center>
<INPUT id="btn2" type=button value=报批>
<INPUT type=button id="btn1" value=详情> <INPUT onClick=" javascript:history.back()" type=button value=返回>
</P></FORM></CENTER></CENTER></BODY></HTML>
