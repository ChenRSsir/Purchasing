
<html>
<head>
<meta http-equiv="Content-Language" content="zh-cn">
<meta http-equiv="Content-Type" content="text/html; charset=gb2312">
<meta name="GENERATOR" content="Microsoft FrontPage 4.0">
<meta name="ProgId" content="FrontPage.Editor.Document">
<link rel="stylesheet" href="css/style.css">
<div ID="overDiv" STYLE="position:absolute; visibility:hidden; z-index:1;"></div>
    <link rel="stylesheet" type="text/css"  href="../jquery-easyui-1.8.5\themes\default\easyui.css"/>
    <link rel="stylesheet" type="text/css" href="../jquery-easyui-1.8.5/themes/icon.css"/>
    <script type="text/javascript" src="../jquery-easyui-1.8.5/jquery.min.js"></script>
    <script type="text/javascript" src="../jquery-easyui-1.8.5/jquery.easyui.min.js"></script>
    <script type="text/javascript" src="../jquery-easyui-1.8.5\locale\easyui-lang-zh_CN.js"></script>
<title>采购计划一览表</title>
<SCRIPT LANGUAGE=javascript>
    $(function () {
        $("#dg").datagrid({
            url:"/selTransmitStock",
            pagination:'true',
            rownumbers:'true',
            selectOnCheck:'true',
            singleSelect:'true',
            checkOnSelect:'true',
            pageList:[2,4,6,8,10],
            columns:[[
                {field:'',title:'',checkbox:true,align:'center'},
                {field:'stockName',title:'采购计划名称',width:250,align:'center'},
                {field:'stockType',title:'采购类型',width:250, align:'center'},
                {field:'status',title:'状态',width:250, align:'center',formatter:function (value,row,index) {
                        if(value=="C001-50"){
                            return "采购计划未下达";
                        }
                    }},
                {field:'budget',title:'预算金额',width:220, align:'center'},
                {field:'remark',title:'备注',width:250, align:'center'},
                {field:'sid',title:'采购id',hidden:true},
                {field:'oid',title:'需求id',hidden:true},
                {field:'imId',title:'编号对照id',hidden:true}
            ]]
        });

    });
    
    function select_check(theForm)
      {
        var count=0;
        for (var k = 0; k < theForm.length; k++)
        if ((theForm[k].type == "checkbox") && (theForm[k].checked))
        count++;
         if (count==0)
         {
            for (k = 0; k < theForm.length; k++)
            {
              if (theForm[k].type == "checkbox")
              theForm[k].checked=true;
            }
         }
         else
         {
            for (k = 0; k < theForm.length; k++)
            {
              if (theForm[k].type == "checkbox")
              theForm[k].checked=false;
            }
         }
      }
      
      function submit_Checkform(theForm,i)
      {
        var count=0;
        for (var k = 0; k < theForm.length; k++)
        if ((theForm[k].type == "checkbox") && (theForm[k].checked))
        count++;
        if (count==0)
        {
          alert("提示信息：\n请选择采购计划。");
          return;
        }
         document.form.p_type.value=i;
         window.document.form.submit();
	
         return true;
      }

      //查看
      function submit_form()
      {
          var rows= $("#dg").datagrid("getSelections");
          if(rows.length==0 || rows.length==null){
              alert("请选中一条数据！");
          }else if(rows.length>1){
              alert("一次只能选择一条数据！");
          }else{
              location.href="/findStockDetails?sid="+rows[0].sid+"&oid="+rows[0].oid+"&stockStatus="+rows[0].status;
          }
      }
      function submit_form_cx()
      {
        form.action="Project_list.asp";
        window.document.form.submit();
      }
	  
	   function getLen(){
		 obj01=document.getElementById("table1");
	 	cGetRow=window.event.srcElement.parentElement.parentElement.rowIndex;
	 }
	  //下达
	  function xiaDa(){
          var rows= $("#dg").datagrid("getSelections");
          if(rows.length==0 || rows.length==null){
              alert("请选中一条数据！");
          }else if(rows.length>1){
              alert("一次只能选择一条数据！");
          }else{
              $.ajax({
                  url:"/transmitStock",
                  type:"get",
                  data:{
                      "imId":rows[0].imId,
                      "sid":rows[0].sid
                  },
                  success:function (data) {
                      if(data=="true"){
                          alert("下达成功！");
                          location.href="../planman/Project_list.html";
                      }else {
                          alert("下达失败！");
                      }
                  }
              });
          }
	 }
</SCRIPT>
</head>
<body>
<center>
<form name=form action="#" method="post">
<input type="hidden" name="p_type" value="3">
<TABLE style="LINE-HEIGHT: 30px" cellSpacing=1 cellPadding=0     width="100%"  bgColor=#336699 borderColorLight=#006699 border=0>
<tr>
<td>
<table cellpadding="3" cellspacing="1" border="0" width="100%" id="table1">
<tr bgcolor="#ffffff"> 
<td width="100%" colspan="20" bgcolor="#ffffff" align=center height=22><B><H2><font  color=#0070C0 >未下达采购计划一览表</b>
<a href="javascript:void(null)" onClick="window.open('../help/Help.asp?Value=未审批采购计划一览表','child','status=NO,scrollbars=yes,toolbar=no,menubar=no,location=no,left=200,top=100,width=700,height=400')" ><img alt="帮助" src="css/help_a.gif" border="0"></a>
</td>
</tr>
    <table id="dg"></table>
<TR Height=35>
<td align="center" class=t2 colspan=8 align=right>
 
   <input type=button value="打开" onClick="submit_form()" >
   <input type=button value="下达" onClick="xiaDa();" >
   <input type=button value="返回" onClick=" javascript:history.back()">
</TD>
</TR>
</table></td></tr></table>

<input type="hidden" name="p_listtype" value="3">
<p align=center>

</p>
</form>
</body>
</html>




